#!/bin/bash
# Time-stamp: "2024-12-22 22:13:53 (ywatanabe)"
# File: /home/ywatanabe/.emacs.d/lisp/Ninja/config/env/04_ninja_user.env

THIS_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

help() {
    cat << EOF
Environment configuration for Ninja user management.
Handles user ID, home directory and environment setup for Ninja agents.

Usage:
    # For multiple agents:
    for i_ninja in \$(seq 1 \$NINJA_N_AGENTS); do
        update_ninja_envs \$i_ninja
    done

    # For single agent:
    update_ninja_envs 1
    echo \$NINJA_HOME

Environment Variables:
    NINJA_ID         - Unique ID for each Ninja agent
    NINJA_USER       - Username in format ninja-XXX
    NINJA_GROUP      - $NINJA_USER
    NINJA_UID        - System UID calculated from base + ID
    NINJA_USER_HOME  - Home directory path for the agent
EOF
}

# Function to update Ninja user environment variables
update_ninja_envs() {
    if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
        help
        return
    fi
    
    local ninja_id="$1"

    # Set Ninja agent ID
    export NINJA_ID=$ninja_id

    # Create unique username for this Ninja agent
    export NINJA_USER="ninja-$(printf "%03d" $ninja_id)"

    # Calculate unique UID for this Ninja agent
    export NINJA_UID=$((NINJA_BASE_UID + ninja_id))

    # Set home directory for this Ninja agent
    export NINJA_USER_HOME=/home/$NINJA_USER
}

if [ ! -z "${NINJA_ID+x}" ]; then
    update_ninja_envs $NINJA_ID
    HOME=$NINJA_USER_HOME
    cd $NINJA_USER_HOME
fi


# EOF
